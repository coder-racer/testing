# Система Управления Рекрутингом

Этот проект представляет собой Систему Управления Рекрутингом, предназначенную для распределения кандидатов между рекрутерами и разработчиками, а также для создания отчетов на основе их деятельности. Система построена с использованием PHP и MySQL.

## Содержание

- [Требования](#требования)
- [Установка](#установка)
- [Использование](#использование)
- [Структура базы данных](#структура-базы-данных)
- [Структура проекта](#структура-проекта)
- [Расположение отчетов](#расположение-отчетов)
- [Примечания](#примечания)

## Требования

- PHP 7.4 или выше
- MySQL 5.7 или выше
- Веб-сервер (например, Apache, Nginx)

## Установка

1. Клонируйте репозиторий:
    ```sh
    git clone https://github.com/coder-racer/testing.git
    cd recruitment-management
    ```

2. Настройте вашу базу данных:
    - Импортируйте предоставленный SQL-файл для создания необходимых таблиц и данных.
    - Обновите файл `database.php` с данными для подключения к вашей базе данных.

3. Настройте ваш веб-сервер, чтобы он указывал на файл `index.php`.

## Использование

1. Убедитесь, что данные для подключения к базе данных правильно указаны в `database.php`.
2. Откройте `index.php` в вашем веб-браузере для запуска скрипта.
3. Скрипт выполнит следующие действия:
    - Выведет количество кандидатов, которые завершили тест и были закреплены за рекрутерами до сбоя CRM.
    - Перераспределит кандидатов между рекрутерами и разработчиками.
    - Создаст отчеты для рекрутеров и разработчиков.
    - Определит разработчика, которому после перераспределения досталось больше всего новых кандидатов и тестовых заданий.

## Структура базы данных

- **candidates**
    - `id`: int, ID кандидата
    - `city_id`: int, ID города
    - `fio`: varchar, ФИО кандидата
    - `phone`: varchar, телефон кандидата
    - `date_test`: datetime, дата прохождения теста

- **employees**
    - `id`: int, ID сотрудника
    - `fio`: varchar, ФИО сотрудника
    - `role`: varchar, роль сотрудника ('Рекрутер' или 'Разработчик')
    - `efficiency`: int, эффективность сотрудника
    - `attached_candidates_count`: int, количество прикрепленных кандидатов

- **candidate_to_employee_assign**
    - `candidate_id`: int, ID кандидата
    - `city_id`: int, ID города
    - `employee_id`: int, ID сотрудника
    - `created_at`: datetime, дата и время назначения

## Структура проекта

- `database.php`: Управляет подключением к базе данных с использованием PDO.
- `recruitment.php`: Содержит класс `Recruitment`, который обрабатывает распределение кандидатов и создание отчетов.
- `index.php`: Главная точка входа для запуска скрипта.

## Расположение отчетов

После выполнения скрипта создаются два файла отчетов в формате CSV:
1. `recruiter_report.csv` - отчет по рекрутерам.
2. `developer_report.csv` - отчет по разработчикам.

Эти файлы создаются в той же директории, где находится скрипт `index.php`. Убедитесь, что ваш веб-сервер имеет права на запись в эту директорию, чтобы скрипт мог успешно создавать файлы отчетов.

## Примечания

- Убедитесь, что ваша база данных настроена и доступна из вашей среды PHP.
- При необходимости измените данные для подключения к базе данных в `database.php`.
- Этот проект предполагает, что SQL-режим `only_full_group_by` включен в MySQL, что требует строгого соблюдения стандартов SQL для `GROUP BY` выражений.
- Скрипт использует транзакции для обеспечения целостности данных во время перераспределения кандидатов.
- Логи записываются в файл `recruitment.log` для отслеживания операций, выполняемых скриптом.
